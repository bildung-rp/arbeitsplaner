YUI.add("moodle-local_aclmodules-modmessages",function(e,t){M.local_aclmodules=M.local_aclmodules||{},M.local_aclmodules.message=function(t){function r(t,r){var i={};i.useridfrom=r.one('input[name="useridfrom"]').get("value"),i.useridto=r.one('[name="useridto"]').get("value"),i.message=r.one('textarea[name="message"]').get("value"),i.modid=t,i.action="sendmessage";var o=e.one("#modmessages-status-"+t),u=e.one("#modmessages-"+t),a=M.cfg.wwwroot+"/local/aclmodules/ajax/modmessage.php";o.setHTML(n),e.io(a,{data:i,on:{success:function(t,n){var r;try{r=e.JSON.parse(n.responseText),o.setHTML("")}catch(i){o.setHTML("parsefailed")}if(r.result=="sendmessage"){var a=e.Node.create(r.modmessages);u.replace(a),s()}}}})}function i(t,n,r){var i={};i.messageid=n,i.modid=t,i.action="setreadmessage";var s=e.one("#modmessages-header-"+t+" .modmessage-header-info"),o=M.cfg.wwwroot+"/local/aclmodules/ajax/modmessage.php";e.io(o,{data:i,on:{success:function(t,n){var i;try{i=e.JSON.parse(n.responseText)}catch(o){alert("parseerror")}i.result=="setreadmessage"&&(s&&i.modmessagesheaderinfo&&s.setHTML(i.modmessagesheaderinfo),i.modmessagesreadinfo&&r.replace(i.modmessagesreadinfo))}}})}function s(){e.all(".modmessages-unread").each(function(e,t){var n=e.ancestor("form"),r=e.get("id").split("-")[2],s=e.get("id").split("-")[3];e.on("click",function(t){t.preventDefault(),i(r,s,e)})}),e.all('button[id^="btnsendmessage_"]').each(function(e,t){var n=e.ancestor("form"),i=e.get("id").split("_")[1];e.on("click",function(e){e.preventDefault(),r(i,n)})}),e.all('button[id^="btnsendnewmessage_"]').each(function(e,t){var n=e.ancestor("form"),i=e.get("id").split("_")[1];e.on("click",function(e){e.preventDefault(),r(i,n)})}),e.all(".modmessagesold-header").each(function(e,t){var n=e.next(".modmessagesold-content");e.on("click",function(t){t.preventDefault();var r=e.one("a");r.hasClass("modmessages-img-collapsed")?r.replaceClass("modmessages-img-collapsed","modmessages-img-expanded"):r.replaceClass("modmessages-img-expanded","modmessages-img-collapsed"),n.toggleView()})})}function o(t,r){var i={};i.modid=r,i.action="getmessages";var o=t.one(".status");o.setHTML(n);var u=M.cfg.wwwroot+"/local/aclmodules/ajax/modmessage.php";e.io(u,{data:i,on:{success:function(n,r){var i;try{i=e.JSON.parse(r.responseText),o.setHTML("")}catch(u){o.setHTML("parsefailed")}i.result=="getmessages"&&(t.ancestor().append(i.modmessages),s())}}})}function u(t,n){var r=e.one("#modmessages-"+n),i=t.one("a");return r?(i.hasClass("modmessages-img-collapsed")?i.replaceClass("modmessages-img-collapsed","modmessages-img-expanded"):i.replaceClass("modmessages-img-expanded","modmessages-img-collapsed"),r.toggleView(),!0):(o(t,n),i.replaceClass("modmessages-img-collapsed","modmessages-img-expanded"),!0)}function a(){s(),e.all('div[id^="modmessages-header-"]').each(function(e,t){var n=e.get("id").split("-")[2];e.on("click",function(t){t.preventDefault(),u(e,n)})})}var n='<img src="'+M.util.image_url("i/ajaxloader","moodle")+'" />';a()}},"@VERSION@",{requires:["node","json","panel","plugin","io"]});
