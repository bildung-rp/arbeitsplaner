YUI.add("moodle-local_aclmodules-levels",function(e,t){M.local_aclmodules=M.local_aclmodules||{},M.local_aclmodules.editform=function(t,n){function l(){a=e.one("document").on("keydown",function(e){e.keyCode===27&&(e.preventDefault(),p(!1)),e.keyCode===13&&(e.preventDefault(),p(!0))}),u.push(a)}function c(){while(a=u.shift())a.detach()}function h(){r.hide(),i.hide(),s.hide(),f.show(),l(),o.set("type","text"),o.focus().select()}function p(t){r.show(),i.show(),s.show(),t?r.setContent(o.get("value")):o.set("value",r.getContent()),o.set("type","hidden"),f.hide(),c();var n=o.get("name").replace("[","_").replace("]",""),u=e.all('input[value="'+n+'"]');u.setAttribute("title",o.get("value"))}function d(){n(t.get("id"))}function v(){i.on("click",function(e){e.preventDefault(),h()}),s.on("click",function(e){e.preventDefault(),d()}),o.on("blur",function(e){e.preventDefault(),p()}),f.hide(),t.append(f)}var r=t.one("span"),i=t.one(".editlevellink"),s=t.one(".deletelevellink"),o=t.one("input"),u=[],a,f=e.Node.create("<span />").addClass("editinstructions").setAttrs({id:"id_editinstructions"}).set("innerHTML",M.str.local_aclmodules.edittitleinstructions);v()},M.local_aclmodules.editlevels=function(t){function u(n){var r=e.Node.create('<div id="newlevel_'+i+'" class="editleveldiv"></div>');return r.appendChild(e.Node.create("<span></span>")),r.appendChild(e.Node.create('<input type="hidden" name="newlevel['+i+']" value="" />')),r.appendChild(e.Node.create('<a href="#" class="editlevellink">'+t.icons.edit+"</a>")),r.appendChild(e.Node.create('<a href="#" class="deletelevellink">'+t.icons.del+"</a>")),new M.local_aclmodules.editform(r,function(e){c(e)},!0),r}function a(t){var n;s.each(function(s,o){var a=s.getDOMNode(),f=e.one(a.insertCell(t));f.addClass("cell");if(o===0)n=u(t),f.append(n);else{var l=e.Node.create('<input type="radio" />');l.set("name","userlevel["+r[o-1]+"]"),l.set("value","newlevel_"+i),l.on("click",function(e){p(e.target)}),f.setContent(l)}}),i++,n.one(".editlevellink").simulate("click")}function f(e){s.each(function(t,n){var r=t.getDOMNode();r.deleteCell(e)}),n--,h()}function l(){a(n),n++}function c(e){var t=s.item(0).all("td div");t.some(function(t,n){if(e==t.get("id"))return f(n+2),!0})}function h(){var t=e.all('span[id^="u_"]');t.each(function(t,n){var r=t.get("id").split("_")[1],i=e.one("input[name='userlevel["+r+"]']:checked");i&&i.get("value")!="level_0"?(t.removeClass("unassigned"),t.addClass("assigned")):(t.removeClass("assigned"),t.addClass("unassigned"))})}function p(t){var n=e.one(t),r=n.get("name"),i=r.match(/userlevel\[(.*)\]/),s=i[1],o=e.one("#u_"+s);n.get("value")!="level_0"?(o.removeClass("unassigned"),o.addClass("assigned")):(o.removeClass("assigned"),o.addClass("unassigned"))}function d(){o||(o=!0,window.onbeforeunload=function(){return"notsavedwarning"})}function v(){s=e.all("#acl-levels tr"),e.all("input[name^='userlevel']").on("click",function(e){p(e.target),d()}),h(),e.one("#levelsform").on("submit",function(){window.onbeforeunload=null});var t=e.all(".editleveldiv");t.each(function(e,t){new M.local_aclmodules.editform(e,function(e){c(e),d()},!1)});var n=e.one("#addlevel");n&&n.on("click",function(e){e.preventDefault(),l(),d()})}var n=t.levelcount+2,r=t.userids,i=0,s,o=!1;v()}},"@VERSION@",{requires:["base","node"]});
